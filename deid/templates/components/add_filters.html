<!-- Template filter row (hidden) - Keep this outside the container -->
<div id="filter-template" class="filter-row w-full flex items-center gap-2 mt-2" style="display: none;">
    <!-- Field Selection Dropdown -->
    <select name="tag" class="h-full border-2 border-gray-400 p-2 bg-white" required>
        {% for field_id, field_name in dicom_fields %}
            <option value="{{ field_id }}">{{ field_name }}</option>
        {% endfor %}
    </select>

    <!-- Operation Dropdown -->
    <select name="action" class="h-full border-2 border-gray-400 p-2 bg-white" required>
        <option value="equalsIgnoreCase">Equals</option>
        <option value="not_equalsIgnoreCase">Does Not Equal</option>
        <option value="containsIgnoreCase">Contains</option>
        <option value="not_containsIgnoreCase">Does Not Contain</option>
        <option value="startsWithIgnoreCase">Starts With</option>
        <option value="not_startsWithIgnoreCase">Does Not Start With</option>
        <option value="endsWithIgnoreCase">Ends With</option>
        <option value="not_endsWithIgnoreCase">Does Not End With</option>
        <option value="isLessThan">Less Than</option>
        <option value="isGreaterThan">Greater Than</option>
    </select>

    <!-- Value Input -->
    <input class="h-10 border-2 border-gray-400 p-1" 
           type="text" 
           name="value" 
           placeholder="Enter value" 
           class="h-full border-2 border-gray-400 p-2 bg-white"
           required>

    <!-- Delete Button -->
    <button type="button" 
            onclick="removeFilter(this)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
            </svg>  
    </button>
</div>

<!-- Separate container for active filters -->
<div id="filters-container" class="w-full flex-row gap-2">
</div>

<!-- Add Filter button -->
<button type="button" class="mt-2 px-2 py-1 bg-white shadow text-sm hover:bg-blue-100"
        onclick="addFilter()">
    + Add Filter
</button>

<script>
function addFilter() {
    // Get the template content
    const template = document.querySelector('#filter-template');
    const newFilter = template.cloneNode(true);
    
    // Make the new filter visible
    newFilter.style.display = 'flex';
    newFilter.removeAttribute('id');
    
    // Clear any values in the new filter
    newFilter.querySelector('input[name="value"]').value = '';
    
    // Reset dropdowns to first option
    newFilter.querySelectorAll('select').forEach(select => {
        select.selectedIndex = 0;
    });
    
    // Add the new filter to the filters container
    document.querySelector('#filters-container').appendChild(newFilter);

    return newFilter;
}

function removeFilter(button) {
    button.closest('.filter-row').remove();
}
</script>
